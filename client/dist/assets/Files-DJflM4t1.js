import{_ as G,u as W,j as H,c as i,f as T,a as o,h as p,t as l,d as x,k as J,F as S,l as U,b as O,v as Q,m as X,w as Y,i as E,r as d,p as Z,q as V,o as s,n as A}from"./index-fsJvMXAk.js";import{N as tt}from"./Navbar-jp9is5ex.js";import"./image-DM1O7qIR.js";const et={class:"files-page"},nt={class:"container"},ot={key:0,class:"file-count"},it={key:0,class:"loading"},st={key:1,class:"empty"},at={key:2,class:"files-grid"},lt=["onClick"],rt=["src","alt"],ut={key:1,class:"file-icon"},ct={class:"file-info"},dt=["title"],vt={class:"file-meta"},pt={class:"file-size"},ft={class:"file-date"},bt={class:"file-actions"},gt=["onClick"],_t=["onClick"],ht={key:3,class:"pagination"},mt=["disabled"],yt={class:"pagination-numbers"},kt=["onClick","disabled"],Ct={class:"pagination-input"},wt=["max"],xt=["disabled"],Ft=["src","alt"],Mt={key:1,class:"file-icon-large"},Bt={class:"preview-info"},Nt={__name:"Files",setup(Pt){const F=W(),m=d(!0),f=d([]),b=d(0),r=d(1),y=d(21),k=d(!1),u=d(null),g=d(""),D=V(()=>{const e=[],t=v.value,a=r.value;t>=1&&e.push(1);const n=Math.max(2,a-2),c=Math.min(t-1,a+2);n>2&&e.push("...");for(let w=n;w<=c;w++)e.push(w);return c<t-1&&e.push("..."),t>1&&e.push(t),e});function M(){const e=parseInt(g.value);!isNaN(e)&&e>=1&&e<=v.value&&(h(e),g.value="")}async function _(e=1){m.value=!0,r.value=e;try{const t=(e-1)*y.value,a=await E.get("/api/files",{headers:{Authorization:`Bearer ${F.token}`},params:{limit:y.value,offset:t}});f.value=a.data.files,b.value=a.data.total||0}catch(t){console.error("Failed to load files:",t)}m.value=!1}function h(e){e<1||e>v.value||_(e)}function L(){r.value>1&&h(r.value-1)}function K(){r.value<v.value&&h(r.value+1)}const v=V(()=>Math.ceil(b.value/y.value));function B(e){return e&&e.startsWith("image/")}function N(e){return e&&e.split(".").pop().toUpperCase()||"FILE"}function P(e){if(!e)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"];if(typeof e=="string"){const c=parseFloat(e);if(!isNaN(c))return c+" MB"}const n=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,n)*100)/100+" "+a[n]}function $(e){return new Date(e).toLocaleString("zh-CN")}function C(e){return`${window.location.origin}/file/${encodeURIComponent(e)}`}function R(e){const t=C(e);navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>{alert("已复制到剪贴板")}).catch(()=>{I(t)}):I(t)}function I(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),alert("已复制到剪贴板")}catch{alert("复制失败，请手动复制")}document.body.removeChild(t)}async function j(e){var t,a;if(confirm("确定要删除这个文件吗？"))try{await E.delete(`/api/files/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${F.token}`}}),alert("删除成功"),f.value.filter(c=>c.file_id!==e).length===0&&r.value>1?_(r.value-1):_(r.value)}catch(n){alert("删除失败: "+(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.error)||n.message))}}function q(e){u.value=e,k.value=!0}function z(){k.value=!1,u.value=null}return H(()=>{_()}),(e,t)=>{const a=Z("router-link");return s(),i("div",et,[T(tt),o("div",nt,[o("h1",null,[t[2]||(t[2]=p("文件列表 ",-1)),b.value>0?(s(),i("span",ot,"("+l(b.value)+")",1)):x("",!0)]),m.value?(s(),i("div",it," 加载中... ")):f.value.length===0?(s(),i("div",st,[t[4]||(t[4]=o("p",null,"暂无文件",-1)),T(a,{to:"/upload",class:"ghibli-button ghibli-button-primary upload-link"},{default:J(()=>[...t[3]||(t[3]=[p("去上传",-1)])]),_:1})])):(s(),i("div",at,[(s(!0),i(S,null,U(f.value,n=>(s(),i("div",{key:n.id,class:"file-card ghibli-card"},[o("div",{class:"file-preview",onClick:c=>q(n)},[B(n.file_type)?(s(),i("img",{key:0,src:C(n.id),alt:n.file_name},null,8,rt)):(s(),i("div",ut,l(N(n.file_name)),1))],8,lt),o("div",ct,[o("div",{class:"file-name",title:n.file_name},l(n.file_name),9,dt),o("div",vt,[o("span",{class:A(["platform-badge",n.channel])},l(n.channel),3),o("span",pt,l(P(n.file_size)),1)]),o("div",ft,l($(n.created_at)),1)]),o("div",bt,[o("button",{onClick:c=>R(n.id),class:"ghibli-button ghibli-button-secondary action-button copy"}," 复制链接 ",8,gt),o("button",{onClick:c=>j(n.id),class:"ghibli-button ghibli-button-secondary action-button delete"}," 删除 ",8,_t)])]))),128))])),v.value>1?(s(),i("div",ht,[o("button",{onClick:L,disabled:r.value===1,class:"ghibli-button ghibli-button-primary pagination-button"}," 上一页 ",8,mt),o("div",yt,[(s(!0),i(S,null,U(D.value,n=>(s(),i("button",{key:n,onClick:c=>h(n),disabled:n==="...",class:A(["ghibli-button","ghibli-button-secondary","pagination-number",{active:r.value===n}])},l(n),11,kt))),128))]),o("div",Ct,[O(o("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>g.value=n),type:"number",min:"1",max:v.value,onKeyup:X(M,["enter"]),class:"ghibli-input page-input"},null,40,wt),[[Q,g.value]]),o("button",{onClick:M,class:"ghibli-button ghibli-button-primary page-go-button"}," 跳转 ")]),o("button",{onClick:K,disabled:r.value===v.value,class:"ghibli-button ghibli-button-primary pagination-button"}," 下一页 ",8,xt)])):x("",!0)]),k.value?(s(),i("div",{key:0,class:"preview-modal",onClick:z},[o("div",{class:"preview-content ghibli-card",onClick:t[1]||(t[1]=Y(()=>{},["stop"]))},[o("button",{onClick:z,class:"ghibli-button ghibli-button-secondary close-button"},"×"),B(u.value.content_type)?(s(),i("img",{key:0,src:C(u.value.file_id),alt:u.value.file_name},null,8,Ft)):(s(),i("div",Mt,l(N(u.value.file_name)),1)),o("div",Bt,[o("p",null,[t[5]||(t[5]=o("strong",null,"文件名:",-1)),p(" "+l(u.value.file_name),1)]),o("p",null,[t[6]||(t[6]=o("strong",null,"大小:",-1)),p(" "+l(P(u.value.file_size)),1)]),o("p",null,[t[7]||(t[7]=o("strong",null,"类型:",-1)),p(" "+l(u.value.content_type),1)]),o("p",null,[t[8]||(t[8]=o("strong",null,"平台:",-1)),p(" "+l(u.value.platform),1)]),o("p",null,[t[9]||(t[9]=o("strong",null,"上传时间:",-1)),p(" "+l($(u.value.created_at)),1)])])])])):x("",!0)])}}},Tt=G(Nt,[["__scopeId","data-v-bec2ebdd"]]);export{Tt as default};
